<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Julien Richard-Foy julien@richard-foy.fr" />
  <meta name="author" content="" />
  <meta name="author" content="Scala Days – June 1st, 2017" />
  <meta name="author" content="" />
  <meta name="author" content="" />
  <meta name="author" content="http://julienrf.github.io/2017/existential-types" />
  <title>Existential Types – Make OOP Great Again!</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
  </style>
  <link rel="stylesheet" type="text/css" media="screen, projection, print"
    href="slidy/styles/slidy.css" />
  <script src="slidy/scripts/slidy.js"
    charset="utf-8" type="text/javascript"></script>
</head>
<body>
<div class="slide titlepage">
  <h1 class="title">Existential Types – Make OOP Great Again!</h1>
  <p class="author">
Julien Richard-Foy <script type="text/javascript">
<!--
h='&#114;&#x69;&#x63;&#104;&#x61;&#114;&#100;&#x2d;&#102;&#x6f;&#x79;&#46;&#102;&#114;';a='&#64;';n='&#106;&#x75;&#108;&#x69;&#x65;&#110;';e=n+a+h;
document.write('<a h'+'ref'+'="ma'+'ilto'+':'+e+'" clas'+'s="em' + 'ail">'+e+'<\/'+'a'+'>');
// -->
</script><noscript>&#106;&#x75;&#108;&#x69;&#x65;&#110;&#32;&#x61;&#116;&#32;&#114;&#x69;&#x63;&#104;&#x61;&#114;&#100;&#x2d;&#102;&#x6f;&#x79;&#32;&#100;&#x6f;&#116;&#32;&#102;&#114;</noscript><br/><br/>Scala Days – June 1st, 2017<br/><br/><br/><a href="http://julienrf.github.io/2017/existential-types" class="uri">http://julienrf.github.io/2017/existential-types</a>
  </p>
</div>
<div id="outline" class="slide section level3 unnumbered">
<h1>Outline</h1>
<ul>
<li>Motivation</li>
<li><del>Existential types</del> Abstract type members</li>
<li>Use cases
<ul>
<li>Encapsulation</li>
<li>Modularization</li>
<li>Type families</li>
<li>Embedded DSLs</li>
</ul></li>
<li>Summary</li>
</ul>
</div>
<div id="motivation" class="titleslide slide section level1"><h1><span class="header-section-number">1</span> Motivation</h1></div><div id="introduction" class="titleslide slide section level2"><h1><span class="header-section-number">1.1</span> Introduction</h1></div><div id="expression" class="slide section level3 unnumbered">
<h1>Expression</h1>
<blockquote>
<p>a problem well put is half-solved</p>
</blockquote>
<p>John Dewey.</p>
</div><div id="complexity" class="slide section level3 unnumbered">
<h1>Complexity</h1>
<div class="figure">
<img src="fractal.png" alt="Breaking down problems into simpler problems" />
<p class="caption">Breaking down problems into simpler problems</p>
</div>
</div><div id="modularization-and-generalization" class="slide section level3 unnumbered">
<h1>Modularization and generalization</h1>
<ul>
<li>in practice, sub-problems are:
<ul>
<li>rarely <strong>independent</strong> of each other</li>
<li>often <strong>similar</strong></li>
</ul></li>
</ul>
</div><div id="means-of-abstraction" class="slide section level3 unnumbered">
<h1>Means of <strong>abstraction</strong></h1>
<ul>
<li>Define <strong>something</strong> in terms of some <strong>unknown</strong> other thing</li>
</ul>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">def</span> identity[A](a: A): A</code></pre></div>
</div><div id="motivating-example" class="titleslide slide section level2"><h1><span class="header-section-number">1.2</span> Motivating example</h1></div><div id="app-about-music" class="slide section level3 unnumbered">
<h1>App about <strong>music</strong></h1>
<p><img src="chord.svg" width="40%" /> <img src="rhythms.svg" width="40%" /></p>
</div><div id="musicsymbol" class="slide section level3 unnumbered">
<h1><code>MusicSymbol</code> </h1>
<p style="text-align: center; position: absolute; top: 1.5em; bottom: 1.5em; left: 0; right: 0; margin: 0">
<img src="symbols-1.svg" style="min-height: 80%; width: auto; margin-top: 8%" />
</p>
</div><div id="musicsymbol-1" class="slide section level3 unnumbered">
<h1><code>MusicSymbol</code> </h1>
<div class="figure">
<img src="symbols-2.svg" />

</div>
</div><div id="generalize-greaterthan-first-attempt" class="slide section level3 unnumbered">
<h1>Generalize <code>greaterThan</code> (first attempt)</h1>
<div class="figure">
<img src="symbols-3.svg" />

</div>
</div><div id="generalize-greaterthan-second-attempt" class="slide section level3 unnumbered">
<h1>Generalize <code>greaterThan</code> (second attempt)</h1>
<p style="text-align: center; position: absolute; top: 1.5em; bottom: 1.5em; left: 0; right: 0; margin: 0">
<img src="ordering.svg" style="min-height: 80%; width: auto; margin-top: 8%" />
</p>
</div><div id="in-scala" class="slide section level3 unnumbered">
<h1>In Scala…</h1>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">trait</span> Ordering[-A] {
  <span class="kw">def</span> <span class="fu">compare</span>(a1: A, a2: A): Int
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">class</span> Note <span class="kw">extends</span> MusicSymbol { … }

<span class="kw">object</span> Note {
  <span class="kw">implicit</span> <span class="kw">val</span> ordering: Ordering[Note] = …
}

<span class="kw">class</span> Rhythm <span class="kw">extends</span> MusicSymbol { … }

<span class="kw">object</span> Rhythm {
  <span class="kw">implicit</span> <span class="kw">val</span> ordering: Ordering[Rhythm] = …
}</code></pre></div>
</div><div id="useful-business-operation" class="slide section level3 unnumbered">
<h1>Useful business operation</h1>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">def</span> <span class="fu">selectMax</span>(pairs: List[(MusicSymbol, MusicSymbol)]): List[MusicSymbol]</code></pre></div>
</div><div id="packing-values-with-their-ordering-instance" class="slide section level3 unnumbered">
<h1>Packing values with their ordering instance</h1>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">case</span> <span class="kw">class</span> ComparablePair[A &lt;: MusicSymbol](
  first: A, second: A,
  ordering: Ordering[A]
)

<span class="kw">def</span> <span class="fu">selectMax</span>(pairs: List[ComparablePair[_ &lt;: MusicSymbol]]): List[MusicSymbol]</code></pre></div>
</div><div id="packing-values-with-their-ordering-instance-1" class="slide section level3 unnumbered">
<h1>Packing values with their ordering instance</h1>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">case</span> <span class="kw">class</span> ComparablePair[A &lt;: MusicSymbol](
  first: A, second: A,
  ordering: Ordering[A]
)

<span class="kw">def</span> <span class="fu">selectMax</span>(pairs: List[ComparablePair[_ &lt;: MusicSymbol]]): List[MusicSymbol] =
  pairs.<span class="fu">map</span> { pair =&gt;
    <span class="kw">if</span> (pair.<span class="fu">ordering</span>.<span class="fu">greaterThan</span>(pair.<span class="fu">first</span>, pair.<span class="fu">second</span>) pair.<span class="fu">first</span>
    <span class="kw">else</span> pair.<span class="fu">second</span>
  }</code></pre></div>
</div><div id="packing-values-with-their-ordering-instance-2" class="slide section level3 unnumbered">
<h1>Packing values with their ordering instance</h1>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">case</span> <span class="kw">class</span> ComparablePair[A &lt;: MusicSymbol](
  first: A, second: A,
  ordering: Ordering[A]
)

<span class="kw">def</span> <span class="fu">selectMax</span>(pairs: List[ComparablePair[_ &lt;: MusicSymbol]]): List[MusicSymbol] =
  pairs.<span class="fu">map</span> { pair =&gt;
    <span class="kw">if</span> (pair.<span class="fu">ordering</span>.<span class="fu">greaterThan</span>(pair.<span class="fu">first</span>, pair.<span class="fu">second</span>) pair.<span class="fu">first</span>
<span class="co">//                                ^^^^^^^^^^</span>
<span class="co">// type mismatch;</span>
<span class="co">//  found   : pair.first.type (with underlying type _$1)</span>
<span class="co">//  required: _$1</span>
    <span class="kw">else</span> pair.<span class="fu">second</span>
  }</code></pre></div>
</div><div id="packing-values-with-their-ordering-instance-3" class="slide section level3 unnumbered">
<h1>Packing values with their ordering instance</h1>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">case</span> <span class="kw">class</span> ComparablePair[A &lt;: MusicSymbol](
  first: A, second: A,
  ordering: Ordering[A]
)

<span class="kw">def</span> <span class="fu">selectMax</span>(pairs: List[ComparablePair[_ &lt;: MusicSymbol]]): List[MusicSymbol] =
  pairs.<span class="fu">map</span> { pair =&gt;

    <span class="kw">def</span> helper[A &lt;: MusicSymbol](pair: ComparablePair[A]): A =
      <span class="kw">if</span> (pair.<span class="fu">ordering</span>.<span class="fu">greaterThan</span>(pair.<span class="fu">first</span>, pair.<span class="fu">second</span>) pair.<span class="fu">first</span>
      <span class="kw">else</span> pair.<span class="fu">second</span>

    <span class="fu">helper</span>(pair)
  }</code></pre></div>
</div><div id="problem" class="slide section level3 unnumbered">
<h1>Problem</h1>
<ul>
<li>Although the type of the pairs is hidden, we eventually have to define helper methods with explicit type parameters</li>
</ul>
</div>
<div id="existential-types-abstract-type-members" class="titleslide slide section level1"><h1><span class="header-section-number">2</span> <del>Existential types</del> Abstract type members</h1></div><div id="solution-based-on-abstract-type-members" class="titleslide slide section level2"><h1><span class="header-section-number">2.1</span> Solution based on abstract type members</h1></div><div id="abstract-type-members-to-the-rescue" class="slide section level3 unnumbered">
<h1>Abstract type members to the rescue!</h1>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">case</span> <span class="kw">class</span> ComparablePair[A &lt;: MusicSymbol](
  first: A, second: A,
  ordering: Ordering[A]
)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">trait</span> ComparablePair {
  <span class="kw">type</span> A &lt;: MusicSymbol
  <span class="kw">def</span> first: A; <span class="kw">def</span> second: A
  <span class="kw">def</span> ordering: Ordering[A]
}</code></pre></div>
</div><div id="useful-business-operation-again" class="slide section level3 unnumbered">
<h1>Useful business operation (again)</h1>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">def</span> <span class="fu">selectMax</span>(pairs: List[ComparablePair]): List[MusicSymbol] =
  pairs.<span class="fu">map</span> { pair =&gt;
    <span class="kw">if</span> (pair.<span class="fu">ordering</span>.<span class="fu">greaterThan</span>(pair.<span class="fu">first</span>, pair.<span class="fu">second</span>)) pair.<span class="fu">first</span>
    <span class="kw">else</span> pair.<span class="fu">second</span>
  }</code></pre></div>
</div><div id="parameters-vs-abstract-members" class="titleslide slide section level2"><h1><span class="header-section-number">2.2</span> Parameters vs abstract members</h1></div><div id="value-parameters" class="slide section level3 unnumbered">
<h1>Value parameters</h1>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">class</span> <span class="fu">Disc</span>(radius: Double) {

  <span class="kw">def</span> area: Double = Pi * radius * radius

}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">def</span> <span class="fu">printArea</span>(disc: Disc): Unit = <span class="fu">println</span>(disc.<span class="fu">area</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">val</span> disc = <span class="kw">new</span> <span class="fu">Disc</span>(<span class="dv">123</span>)
<span class="fu">printArea</span>(disc)</code></pre></div>
</div><div id="abstract-value-members" class="slide section level3 unnumbered">
<h1>Abstract value members</h1>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">abstract</span> <span class="kw">class</span> Disc {

  <span class="kw">def</span> radius: Double

  <span class="kw">def</span> area: Double = Pi * radius * radius

}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">def</span> <span class="fu">printArea</span>(disc: Disc): Unit = <span class="fu">println</span>(disc.<span class="fu">area</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">val</span> disc = <span class="kw">new</span> Disc { <span class="kw">val</span> radius = <span class="dv">123</span> }
<span class="fu">printArea</span>(disc)</code></pre></div>
</div><div id="type-parameters" class="slide section level3 unnumbered">
<h1>Type parameters</h1>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">trait</span> Ordering[A] {

  <span class="kw">def</span> <span class="fu">compare</span>(a1: A, a2: A): Int

  <span class="kw">def</span> <span class="fu">max</span>(a1: A, a2: A): A = <span class="kw">if</span> (<span class="fu">compare</span>(a1, a2) &gt; <span class="dv">0</span>) a1 <span class="kw">else</span> a2

}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">def</span> printMax[T](t1: T, t2: T, ordering: Ordering[T]): Unit =
  <span class="fu">println</span>(ordering.<span class="fu">max</span>(t1, t2))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">val</span> stringOrdering: Ordering[String] =
  <span class="kw">new</span> Ordering[String] {
    <span class="kw">def</span> <span class="fu">compare</span>(s1: String, s2: String): Int = …
  }
<span class="fu">printMax</span>(<span class="st">&quot;foo&quot;</span>, <span class="st">&quot;bar&quot;</span>, stringOrdering)</code></pre></div>
</div><div id="abstract-type-members" class="slide section level3 unnumbered">
<h1>Abstract type members</h1>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">trait</span> Ordering {

  <span class="kw">type</span> A

  <span class="kw">def</span> <span class="fu">compare</span>(a1: A, a2: A): Int

  <span class="kw">def</span> <span class="fu">max</span>(a1: A, a2: A): A = <span class="kw">if</span> (<span class="fu">compare</span>(a1, a2) &gt; <span class="dv">0</span>) a1 <span class="kw">else</span> a2

}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">def</span> printMax[T](t1: T, t2: T, ordering: Ordering { <span class="kw">type</span> A = T }): Unit =
  <span class="fu">println</span>(ordering.<span class="fu">max</span>(t1, t2))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">val</span> stringOrdering: Ordering { <span class="kw">type</span> A = String } =
  <span class="kw">new</span> Ordering {
    <span class="kw">type</span> A = String
    <span class="kw">def</span> <span class="fu">compare</span>(s1: String, s2: String): Int = …
  }
<span class="fu">printMax</span>(<span class="st">&quot;foo&quot;</span>, <span class="st">&quot;bar&quot;</span>, stringOrdering)</code></pre></div>
</div><div id="scala-square-of-abstraction" class="slide section level3 unnumbered">
<h1>Scala square of abstraction</h1>
<table style="width:44%;">
<colgroup>
<col width="13%" />
<col width="18%" />
<col width="12%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">value</th>
<th align="left">type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">parameter</td>
<td align="left"><code>(x: Int)</code></td>
<td align="left"><code>[A]</code></td>
</tr>
<tr class="even">
<td align="left">member</td>
<td align="left"><code>def x: Int</code></td>
<td align="left"><code>type A</code></td>
</tr>
</tbody>
</table>
</div>
<div id="use-cases" class="titleslide slide section level1"><h1><span class="header-section-number">3</span> Use cases</h1></div><div id="encapsulation" class="titleslide slide section level2"><h1><span class="header-section-number">3.1</span> Encapsulation</h1></div><div id="scala-interface-for-nix-files-api-.unnumbered" class="slide section level3">
<h1><span class="header-section-number">3.1.1</span> Scala interface for *nix files API {.unnumbered}</h1>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">object</span> UnixFiles {
  <span class="kw">def</span> <span class="fu">open</span>(path: String): Int = …
  <span class="kw">def</span> <span class="fu">read</span>(file: Int): String = …
  <span class="kw">def</span> <span class="fu">close</span>(file: Int): Int = …
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">def</span> <span class="fu">readSomething</span>(): Unit = {
  UnixFiles.<span class="fu">read</span>(<span class="dv">42</span>) <span class="co">// I can forge a file descriptor!</span>
}</code></pre></div>
</div><div id="hiding-the-file-type" class="slide section level3 unnumbered">
<h1>Hiding the <code>File</code> type</h1>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">trait</span> UnixFiles {
  <span class="kw">type</span> File
  <span class="kw">def</span> <span class="fu">open</span>(path: String): File
  <span class="kw">def</span> <span class="fu">read</span>(file: File): String
  <span class="kw">def</span> <span class="fu">close</span>(file: File): Int
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">def</span> <span class="fu">readSomething</span>(files: UnixFiles): Unit = {
  files.<span class="fu">read</span>(<span class="dv">42</span>)
  <span class="co">//         ^^</span>
  <span class="co">// Error: Type mismatch;</span>
  <span class="co">//  found: Int</span>
  <span class="co">//  required: files.File</span>
}</code></pre></div>
</div><div id="hiding-the-file-type-1" class="slide section level3 unnumbered">
<h1>Hiding the <code>File</code> type</h1>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">def</span> <span class="fu">readSomething</span>(files: UnixFiles): Unit = {
  <span class="kw">val</span> file = files.<span class="fu">open</span>(<span class="st">&quot;/foo&quot;</span>)
  files.<span class="fu">read</span>(file) <span class="co">// I have no other choice than</span>
                   <span class="co">// calling the `open` method to</span>
                   <span class="co">// get a `File` instance</span>
}</code></pre></div>
</div><div id="why-is-it-different-from-using-an-opaque-type" class="slide section level3 unnumbered">
<h1>Why is it different from using an opaque type?</h1>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">object</span> UnixFiles {

  <span class="kw">sealed</span> <span class="kw">trait</span> File
  <span class="kw">private</span> <span class="kw">case</span> <span class="kw">class</span> <span class="fu">FileImpl</span>(value: Int) <span class="kw">extends</span> File

  <span class="kw">def</span> <span class="fu">open</span>(path: String): File = {
    …
    <span class="fu">FileImpl</span>(…)
  }

  <span class="kw">def</span> <span class="fu">read</span>(file: File): String = {
    <span class="kw">val</span> fileImpl = file.<span class="fu">asInstanceOf</span>[FileImpl]
    …
  }

}</code></pre></div>
</div><div id="why-is-it-different-from-using-an-opaque-type-1" class="slide section level3 unnumbered">
<h1>Why is it different from using an opaque type?</h1>
<ul>
<li>Casts everywhere</li>
<li>Also “hidden” from the point of view of implementers!</li>
</ul>
</div><div id="modularization" class="titleslide slide section level2"><h1><span class="header-section-number">3.2</span> Modularization</h1></div><div id="user-interface-component" class="slide section level3 unnumbered">
<h1>User interface <code>Component</code> </h1>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">trait</span> Component[Model, Msg] {
  <span class="kw">def</span> init: Model
  <span class="kw">def</span> <span class="fu">view</span>(model: Model): Html
  <span class="kw">def</span> <span class="fu">update</span>(msg: Msg, model: Model): Model
}</code></pre></div>
</div><div id="counter-component" class="slide section level3 unnumbered">
<h1><code>Counter</code> component</h1>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">object</span> Counter <span class="kw">extends</span> Component[Int, CounterMsg] {

  <span class="kw">def</span> <span class="fu">view</span>(model: Int): Html = &lt;span&gt;value = { model }&lt;/span&gt;

  <span class="kw">def</span> <span class="fu">update</span>(msg: CounterMsg, model: Int): model = msg <span class="kw">match</span> {
    <span class="kw">case</span> Inc   =&gt; model + <span class="dv">1</span>
    <span class="kw">case</span> Reset =&gt; <span class="dv">0</span>
  }

}

<span class="kw">sealed</span> <span class="kw">trait</span> CounterMsg
<span class="kw">case</span> <span class="kw">object</span> Inc <span class="kw">extends</span> CounterMsg
<span class="kw">case</span> <span class="kw">object</span> Reset <span class="kw">extends</span> CounterMsg</code></pre></div>
</div><div id="container-component" class="slide section level3 unnumbered">
<h1><code>Container</code> component</h1>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">class</span> Container[Model, Msg](child: Component[Model, Msg])
  <span class="kw">extends</span> Component[Model, Msg] {
  
  <span class="kw">def</span> <span class="fu">view</span>(model: Model): Html =
    &lt;div <span class="kw">class</span>=<span class="st">&quot;container&quot;</span>&gt;{ child.<span class="fu">view</span>(model) }&lt;/div&gt;

  <span class="kw">def</span> <span class="fu">update</span>(msg: Msg, model: Model): Model =
    child.<span class="fu">update</span>(msg, model)

}</code></pre></div>
</div><div id="tabs-component" class="slide section level3 unnumbered">
<h1><code>Tabs</code> component</h1>
<p>
<img src="tabs.jpg" />
</p>
</div><div id="tabs-component-1" class="slide section level3 unnumbered">
<h1><code>Tabs</code> component</h1>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">class</span> <span class="fu">Tabs</span>(children: List[(String, Component[_, _]]))
  <span class="kw">extends</span> Component[TabsModel[_], TabsMsg] {

  <span class="kw">def</span> <span class="fu">view</span>(model: TabsModel[_]): Html = …

  <span class="kw">def</span> <span class="fu">update</span>(msg: TabsMsg, model: TabsModel[_]): TabsModel[_] = …

}

<span class="kw">case</span> <span class="kw">class</span> TabsModel[Model](index: Int, childModel: Model)

<span class="kw">sealed</span> <span class="kw">trait</span> TabsMsg
<span class="kw">case</span> <span class="kw">class</span> <span class="fu">Select</span>(n: Int) <span class="kw">extends</span> TabsMsg
<span class="kw">case</span> <span class="kw">class</span> ChildMsg[Msg](value: Msg) <span class="kw">extends</span> TabsMsg</code></pre></div>
</div><div id="tabs-component-implementation" class="slide section level3 unnumbered">
<h1><code>Tabs</code> component implementation</h1>
<div class="figure">
<img src="censored.jpg" />

</div>
</div><div id="redesign-component-with-abstract-type-members" class="slide section level3 unnumbered">
<h1>Redesign <code>Component</code> with abstract type members</h1>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">trait</span> Component {

  <span class="kw">type</span> Model

  <span class="kw">type</span> Msg

  <span class="kw">def</span> <span class="fu">view</span>(model: Model): Html

  <span class="kw">def</span> <span class="fu">update</span>(msg: Msg, model: Model): Model

}</code></pre></div>
</div><div id="counter-again" class="slide section level3 unnumbered">
<h1><code>Counter</code> (again)</h1>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">object</span> Counter <span class="kw">extends</span> Component {

  <span class="kw">type</span> Model = Int

  <span class="kw">def</span> <span class="fu">view</span>(model: Model): Html = &lt;span&gt;value = { model }&lt;/span&gt;

  <span class="kw">sealed</span> <span class="kw">trait</span> Msg
  <span class="kw">case</span> <span class="kw">object</span> Inc <span class="kw">extends</span> Msg
  <span class="kw">case</span> <span class="kw">object</span> Reset <span class="kw">extends</span> Msg

  <span class="kw">def</span> <span class="fu">update</span>(msg: Msg, model: Model): Model = msg <span class="kw">match</span> {
    <span class="kw">case</span> Inc   =&gt; model + <span class="dv">1</span>
    <span class="kw">case</span> Reset =&gt; <span class="dv">0</span>
  }
  
}</code></pre></div>
</div><div id="container-again" class="slide section level3 unnumbered">
<h1><code>Container</code> (again)</h1>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">trait</span> Container <span class="kw">extends</span> Component {

  <span class="kw">val</span> child: Component

  <span class="kw">type</span> Model = child.<span class="fu">Model</span>

  <span class="kw">type</span> Msg = child.<span class="fu">Msg</span>

  <span class="kw">def</span> <span class="fu">view</span>(model: Model): Html =
    &lt;div <span class="kw">class</span>=<span class="st">&quot;container&quot;</span>&gt;{ child.<span class="fu">view</span>(model) }&lt;/div&gt;

  <span class="kw">def</span> <span class="fu">update</span>(msg: Msg, model: Model): Model = child.<span class="fu">update</span>(msg, model)

}</code></pre></div>
</div><div id="tabs-again" class="slide section level3 unnumbered">
<h1><code>Tabs</code> (again)</h1>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">class</span> <span class="fu">Tabs</span>(children: List[(String, Component])) <span class="kw">extends</span> Component {

  <span class="kw">trait</span> Model {
    <span class="kw">val</span> selected: Component
    <span class="kw">def</span> childModel: selected.<span class="fu">Model</span>
  }

  <span class="kw">sealed</span> <span class="kw">trait</span> Msg
  <span class="kw">case</span> <span class="kw">class</span> <span class="fu">Select</span>(index: Int) <span class="kw">extends</span> Msg
  <span class="kw">trait</span> ChildMsg <span class="kw">extends</span> Msg {
    <span class="kw">val</span> selected: Component
    <span class="kw">def</span> childMsg: selected.<span class="fu">Msg</span>
  }

}</code></pre></div>
</div><div id="tabs-smart-constructors" class="slide section level3 unnumbered">
<h1><code>Tabs</code> – smart constructors</h1>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">class</span> <span class="fu">Tabs</span>(children: List[(String, Component])) <span class="kw">extends</span> Component {

  <span class="kw">trait</span> Model {
    <span class="kw">val</span> selected: Component
    <span class="kw">def</span> childModel: selected.<span class="fu">Model</span>
  }

  <span class="kw">object</span> Model {
    <span class="kw">def</span> <span class="fu">apply</span>(_selected: Component)(_childModel: _selected.<span class="fu">Model</span>) =
      <span class="kw">new</span> Model {
        <span class="kw">val</span> selected: _selected.<span class="fu">type</span> = _selected
        <span class="kw">val</span> childModel = _childModel
      }
  }

}</code></pre></div>
</div><div id="tabs-smart-constructors-1" class="slide section level3 unnumbered">
<h1><code>Tabs</code> – smart constructors</h1>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">class</span> <span class="fu">Tabs</span>(children: List[(String, Component])) <span class="kw">extends</span> Component {

  <span class="kw">trait</span> ChildMsg <span class="kw">extends</span> Msg {
    <span class="kw">val</span> selected: Component
    <span class="kw">def</span> childMsg: selected.<span class="fu">Msg</span>
  }

  <span class="kw">object</span> ChildMsg {
    <span class="kw">def</span> <span class="fu">apply</span>(_selected: Component)(_childMsg: _selected.<span class="fu">Msg</span>) =
      <span class="kw">new</span> ChildMsg {
        <span class="kw">val</span> selected: _selected.<span class="fu">type</span> = _selected
        <span class="kw">val</span> childMsg = _childMsg
      }
  }

}</code></pre></div>
</div><div id="tabs-view-implementation" class="slide section level3 unnumbered">
<h1><code>Tabs</code> – <code>view</code> implementation</h1>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">class</span> <span class="fu">Tabs</span>(children: List[(String, Component])) <span class="kw">extends</span> Component {

  <span class="kw">def</span> <span class="fu">view</span>(model: Model): Html =
    &lt;div <span class="kw">class</span>=<span class="st">&quot;tabs&quot;</span>&gt;
      &lt;ul&gt;{ <span class="kw">for</span> ((label, _) &lt;- children) <span class="kw">yield</span> &lt;li&gt;{ label }&lt;/li&gt; }&lt;/ul&gt;
      &lt;div&gt;
        { model.<span class="fu">selected</span>.<span class="fu">view</span>(model.<span class="fu">childModel</span>) }
      &lt;/div&gt;
    &lt;/div&gt;

}</code></pre></div>
</div><div id="tabs-update-implementation" class="slide section level3 unnumbered">
<h1><code>Tabs</code> – <code>update</code> implementation</h1>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">class</span> <span class="fu">Tabs</span>(children: List[(String, Component])) <span class="kw">extends</span> Component {

  <span class="kw">def</span> <span class="fu">update</span>(msg: Msg, model: Model): Model =
    msg <span class="kw">match</span> {
      <span class="kw">case</span> <span class="fu">Select</span>(index) =&gt;
        <span class="kw">val</span> selected = <span class="fu">children</span>(index)
        <span class="fu">Model</span>(selected)(selected.<span class="fu">init</span>)
      <span class="kw">case</span> msg: ChildMsg =&gt;
        <span class="co">// …</span>
    }

}</code></pre></div>
</div><div id="tabs-update-implementation-2" class="slide section level3 unnumbered">
<h1><code>Tabs</code> – <code>update</code> implementation (2)</h1>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">class</span> <span class="fu">Tabs</span>(children: List[(String, Component])) <span class="kw">extends</span> Component {

  <span class="kw">def</span> <span class="fu">update</span>(msg: Msg, model: Model): Model =
    msg <span class="kw">match</span> {
      <span class="kw">case</span> <span class="fu">Select</span>(index) =&gt;
        <span class="co">// …</span>
      <span class="kw">case</span> msg: ChildMsg =&gt;
        <span class="kw">val</span> childModel =
          model.<span class="fu">selected</span>.<span class="fu">update</span>(
            msg.<span class="fu">childMsg</span>,
            model.<span class="fu">childModel</span>
          )
        <span class="fu">Model</span>(model.<span class="fu">selected</span>)(childModel)
    }

}</code></pre></div>
</div><div id="tabs-update-implementation-3" class="slide section level3 unnumbered">
<h1><code>Tabs</code> – <code>update</code> implementation (3)</h1>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">class</span> <span class="fu">Tabs</span>(children: List[(String, Component])) <span class="kw">extends</span> Component {

  <span class="kw">def</span> <span class="fu">update</span>(msg: Msg, model: Model): Model =
    msg <span class="kw">match</span> {
      <span class="kw">case</span> <span class="fu">Select</span>(index) =&gt;
        <span class="co">// …</span>
      <span class="kw">case</span> msg: ChildMsg =&gt;
        <span class="kw">if</span> (msg.<span class="fu">selected</span> == model.<span class="fu">selected</span>) {
          <span class="kw">val</span> childModel =
            model.<span class="fu">selected</span>.<span class="fu">update</span>(
              msg.<span class="fu">childMsg</span>.<span class="fu">asInstanceOf</span>[model.<span class="fu">selected</span>.<span class="fu">Msg</span>],
              model.<span class="fu">childModel</span>
            )
          <span class="fu">Model</span>(model.<span class="fu">selected</span>)(childModel)
        } <span class="kw">else</span> model
    }

}</code></pre></div>
</div><div id="modularization-summary" class="slide section level3 unnumbered">
<h1>Modularization – summary</h1>
<ul>
<li>Abstract members (both types and values) are useful to encapsulate module internals</li>
<li><strong>Path-dependent types</strong> make it possible to nest modules</li>
<li>Drawbacks
<ul>
<li><strong>No smart constructors</strong> (a la case classes)</li>
<li><strong>No <code>&lt;:&lt;</code></strong> equivalent at the value level</li>
</ul></li>
</ul>
</div><div id="type-families" class="titleslide slide section level2"><h1><span class="header-section-number">3.3</span> Type families</h1></div><div id="type-families-1" class="slide section level3 unnumbered">
<h1>Type families</h1>
<p style="text-align: center; position: absolute; top: 1.5em; bottom: 1.5em; left: 0; right: 0; margin: 0">
<img src="plot-1.svg" style="min-height: 80%; width: auto; margin-top: 8%" />
</p>
</div><div id="type-families-2" class="slide section level3 unnumbered">
<h1>Type families</h1>
<p style="text-align: center; position: absolute; top: 1.5em; bottom: 1.5em; left: 0; right: 0; margin: 0">
<img src="plot-2.svg" style="min-height: 80%; width: auto; margin-top: 8%" />
</p>
</div><div id="naive-solution" class="slide section level3 unnumbered">
<h1>Naive solution</h1>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">trait</span> Plot {
  <span class="kw">def</span> <span class="fu">setDataset</span>(dataset: Dataset): Unit
  <span class="kw">def</span> getDataset: Dataset
}

<span class="kw">trait</span> Dataset</code></pre></div>
</div><div id="naive-solution-xyplot" class="slide section level3 unnumbered">
<h1>Naive solution – <code>XYPlot</code> </h1>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">trait</span> XYPlot <span class="kw">extends</span> Plot {
  <span class="kw">private</span> <span class="kw">var</span> _dataset: XYDataset = _
  <span class="kw">def</span> <span class="fu">setDataset</span>(dataset: Dataset) = _dataset = dataset.<span class="fu">asInstanceOf</span>[XYDataset]
  <span class="kw">def</span> getDataset = _dataset
}

<span class="kw">case</span> <span class="kw">class</span> <span class="fu">XYDataset</span>(series: List[Series]) <span class="kw">extends</span> Dataset
<span class="kw">case</span> <span class="kw">class</span> <span class="fu">Series</span>(values: List[(Double, Double)])</code></pre></div>
</div><div id="solution-with-abstract-type-members" class="slide section level3 unnumbered">
<h1>Solution with abstract type members</h1>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">trait</span> Plot {
  <span class="kw">type</span> Dataset
  <span class="kw">def</span> <span class="fu">setDataset</span>(dataset: Dataset): Unit
  <span class="kw">def</span> getDataset: Dataset
}</code></pre></div>
</div><div id="type-families-3" class="slide section level3 unnumbered">
<h1>Type families</h1>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">trait</span> Plot {
  <span class="kw">type</span> Dataset
  <span class="kw">def</span> <span class="fu">setDataset</span>(dataset: Dataset): Unit
  <span class="kw">def</span> getDataset: Dataset
}</code></pre></div>
</div><div id="type-families-xyplot" class="slide section level3 unnumbered">
<h1>Type families – <code>XYPlot</code> </h1>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">trait</span> XYPlot <span class="kw">extends</span> Plot {

  <span class="kw">case</span> <span class="kw">class</span> <span class="fu">Dataset</span>(series: List[Series])
  <span class="kw">case</span> <span class="kw">class</span> <span class="fu">Series</span>(values: List[(Double, Double)])

  <span class="kw">private</span> <span class="kw">var</span> _dataset: Dataset = _

  <span class="kw">def</span> <span class="fu">setDataset</span>(dataset: Dataset) = _dataset = dataset
  <span class="kw">def</span> getDataset = _dataset

}</code></pre></div>
</div><div id="finally-tagless-encoding" class="titleslide slide section level2"><h1><span class="header-section-number">3.4</span> Finally tagless encoding</h1></div><div id="finally-tagless-encoding-1" class="slide section level3 unnumbered">
<h1>Finally tagless encoding</h1>
<ul>
<li>Useful to define embedded DSLs with a clear algebra</li>
<li>Extensible</li>
</ul>
<p>See also [<a href="http://dl.acm.org/citation.cfm?id=1449935">C. Hofer et al. 2008</a>] and [<a href="http://okmij.org/ftp/tagless-final/#tagless-final">J. Carette et al. 2009</a>]</p>
</div><div id="initial-encoding-vs-final-encoding" class="slide section level3 unnumbered">
<h1>Initial encoding vs final encoding</h1>
<ul>
<li>Initial encoding</li>
</ul>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">sealed</span> <span class="kw">trait</span> Expr
<span class="kw">case</span> <span class="kw">class</span> <span class="fu">Lit</span>(x: Double) <span class="kw">extends</span> Expr
<span class="kw">case</span> <span class="kw">class</span> <span class="fu">Add</span>(lhs: Expr, rhs: Expr) <span class="kw">extends</span> Expr</code></pre></div>
<ul>
<li>Final encoding</li>
</ul>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">trait</span> ExprDsl {
  <span class="kw">trait</span> Expr
  <span class="kw">def</span> <span class="fu">lit</span>(x: Double): Expr
  <span class="kw">def</span> <span class="fu">add</span>(lhs: Expr, rhs: Expr): Expr
}</code></pre></div>
</div><div id="another-example" class="slide section level3 unnumbered">
<h1>Another example</h1>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">trait</span> RPC {
  <span class="kw">type</span> Request[Data]
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">trait</span> Client <span class="kw">extends</span> RPC {
  <span class="kw">type</span> Request[Data] = Data =&gt; HttpRequest
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">trait</span> Server <span class="kw">extends</span> RPC {
  <span class="kw">type</span> Request[Data] = HttpRequest =&gt; Option[Data]
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">def</span> <span class="fu">program</span>(rpc: RPC): rpc.<span class="fu">Request</span>[String] = …</code></pre></div>
<p>See also <a href="https://github.com/julienrf/endpoints">julienrf/endpoints</a> for an intensive usage of this pattern</p>
</div>
<div id="summary" class="titleslide slide section level1"><h1><span class="header-section-number">4</span> Summary</h1></div><div id="summary-1" class="slide section level3 unnumbered">
<h1>Summary</h1>
<ul>
<li>Existential types are <strong>hidden polymorphic types</strong></li>
<li>We can encode them in Scala using <strong>abstract type members</strong></li>
<li>They can be useful in several situations
<ul>
<li>encapsulation</li>
<li>modularization</li>
<li>family polymorphism</li>
<li>embedded DSLs</li>
</ul></li>
</ul>
</div>
<div id="questions" class="titleslide slide section level1"><h1><span class="header-section-number">5</span> Questions?</h1></div>
</body>
</html>
